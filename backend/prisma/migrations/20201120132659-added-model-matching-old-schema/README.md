# Migration `20201120132659-added-model-matching-old-schema`

This migration has been generated by Lucas Gabriel Salina D'Ovidio at 11/20/2020, 2:26:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Image" (
    "id" TEXT NOT NULL,
    "url" TEXT NOT NULL,
    "largeUrl" TEXT NOT NULL,
    "sorting" INTEGER,
    "categoryId" TEXT,
    "productId" TEXT,

    FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY ("productId") REFERENCES "Product"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Category" (
    "id" TEXT NOT NULL,
    "sorting" INTEGER,
    "published" BOOLEAN NOT NULL DEFAULT true,
    "slug_da" TEXT,
    "slug_en" TEXT,
    "name_da" TEXT,
    "name_en" TEXT,
    "description_da" TEXT,
    "description_en" TEXT,
    PRIMARY KEY ("id")
)

CREATE TABLE "Report" (
    "id" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "resolvedAt" DATETIME,
    "image" TEXT NOT NULL,
    "url" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    PRIMARY KEY ("id")
)

CREATE TABLE "Product" (
    "id" TEXT NOT NULL,
    "code" TEXT NOT NULL,
    "customizable" BOOLEAN NOT NULL DEFAULT true,
    "hasMultiplePrices" BOOLEAN NOT NULL DEFAULT false,
    "sorting" INTEGER,
    "published" BOOLEAN NOT NULL DEFAULT false,
    "selectedAttrinutes" TEXT,
    "slug_da" TEXT,
    "slug_en" TEXT,
    "name_da" TEXT,
    "name_en" TEXT,
    "description_da" TEXT,
    "description_en" TEXT,
    "priceId" TEXT,

    FOREIGN KEY ("priceId") REFERENCES "Price"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Sku" (
    "id" TEXT NOT NULL,
    "sku" TEXT NOT NULL,
    "productId" TEXT NOT NULL,
    "priceId" TEXT,
    "imageId" TEXT,

    FOREIGN KEY ("productId") REFERENCES "Product"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("priceId") REFERENCES "Price"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY ("imageId") REFERENCES "Image"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Attribute" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "options" TEXT NOT NULL,
    "position" INTEGER NOT NULL,
    PRIMARY KEY ("id")
)

CREATE TABLE "Price" (
    "id" TEXT NOT NULL,
    "DKK" INTEGER NOT NULL,
    "USD" INTEGER NOT NULL,
    "EUR" INTEGER NOT NULL,
    "GBP" INTEGER NOT NULL,
    PRIMARY KEY ("id")
)

CREATE TABLE "Cart" (
    "id" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "items" TEXT,
    PRIMARY KEY ("id")
)

CREATE TABLE "ShippingProfile" (
    "id" TEXT NOT NULL,
    "code" TEXT NOT NULL,
    "priceId" TEXT NOT NULL,

    FOREIGN KEY ("priceId") REFERENCES "Price"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "PurchasedSku" (
    "id" TEXT NOT NULL,
    "code" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "price" INTEGER NOT NULL,
    "currency" TEXT NOT NULL,
    "image" TEXT NOT NULL,
    "variationInfo" TEXT NOT NULL,
    "orderId" TEXT,

    FOREIGN KEY ("orderId") REFERENCES "Order"("id") ON DELETE SET NULL ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Order" (
    "id" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "shipping" TEXT NOT NULL,
    "shippingCosts" TEXT NOT NULL,
    "total" INTEGER NOT NULL,
    "currency" TEXT NOT NULL,
    "charge" TEXT NOT NULL,
    "shippedAt" DATETIME,
    "fullfilled" BOOLEAN NOT NULL DEFAULT false,
    "archived" BOOLEAN NOT NULL DEFAULT false,
    "trackingCode" TEXT,
    "auth" TEXT NOT NULL,
    "customerId" TEXT NOT NULL,

    FOREIGN KEY ("customerId") REFERENCES "Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    PRIMARY KEY ("id")
)

CREATE TABLE "Customer" (
    "id" TEXT NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "address" TEXT NOT NULL,
    "address2" TEXT,
    "city" TEXT NOT NULL,
    "zip" TEXT NOT NULL,
    "country" TEXT NOT NULL,
    PRIMARY KEY ("id")
)

CREATE TABLE "_CategoryToProduct" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "Product"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

PRAGMA foreign_keys=off;
DROP TABLE "Test";
PRAGMA foreign_keys=on

PRAGMA foreign_keys=off;
DROP TABLE "TestUser";
PRAGMA foreign_keys=on

CREATE UNIQUE INDEX "Category.slug_da_unique" ON "Category"("slug_da")

CREATE UNIQUE INDEX "Category.slug_en_unique" ON "Category"("slug_en")

CREATE UNIQUE INDEX "Product.code_unique" ON "Product"("code")

CREATE UNIQUE INDEX "Product.slug_da_unique" ON "Product"("slug_da")

CREATE UNIQUE INDEX "Product.slug_en_unique" ON "Product"("slug_en")

CREATE UNIQUE INDEX "Sku.sku_unique" ON "Sku"("sku")

CREATE UNIQUE INDEX "ShippingProfile.code_unique" ON "ShippingProfile"("code")

CREATE UNIQUE INDEX "Order.auth_unique" ON "Order"("auth")

CREATE UNIQUE INDEX "_CategoryToProduct_AB_unique" ON "_CategoryToProduct"("A", "B")

CREATE INDEX "_CategoryToProduct_B_index" ON "_CategoryToProduct"("B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201120122806-make-permission-name-unique..20201120132659-added-model-matching-old-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,26 +1,13 @@
 datasource db {
     provider = "sqlite"
-    url = "***"
+    url = "***"
 }
 generator client {
     provider = "prisma-client-js"
 }
-model Test {
-    id         String    @id @default(cuid())
-    name       String
-    TestUser   TestUser? @relation(fields: [testUserId], references: [id])
-    testUserId String?
-}
-
-model TestUser {
-    id   String @id @default(cuid())
-    name String
-    test Test[]
-}
-
 model Permission {
     id    String @id @default(cuid())
     name  String @unique
     users User[]
@@ -34,4 +21,145 @@
     resetToken       String?
     resetTokenExpiry Float?
     permissions      Permission[]
 }
+
+model Image {
+    id         String    @id @default(cuid())
+    url        String
+    largeUrl   String
+    sorting    Int?
+    category   Category? @relation(fields: [categoryId], references: [id])
+    product    Product?  @relation(fields: [productId], references: [id])
+    Sku        Sku[]
+    categoryId String?
+    productId  String?
+}
+
+model Category {
+    id             String    @id @default(cuid())
+    sorting        Int?
+    published      Boolean   @default(true)
+    products       Product[]
+    images         Image[]
+    slug_da        String?   @unique
+    slug_en        String?   @unique
+    name_da        String?
+    name_en        String?
+    description_da String?
+    description_en String?
+}
+
+model Report {
+    id          String    @id @default(cuid())
+    createdAt   DateTime  @default(now())
+    resolvedAt  DateTime?
+    image       String
+    url         String
+    description String
+}
+
+model Product {
+    id                 String     @id @default(cuid())
+    code               String     @unique
+    customizable       Boolean    @default(true)
+    price              Price?     @relation(fields: [priceId], references: [id])
+    hasMultiplePrices  Boolean    @default(false)
+    sorting            Int?
+    published          Boolean    @default(false)
+    categories         Category[]
+    images             Image[]
+    skus               Sku[]
+    selectedAttrinutes String?
+    slug_da            String?    @unique
+    slug_en            String?    @unique
+    name_da            String?
+    name_en            String?
+    description_da     String?
+    description_en     String?
+    priceId            String?
+}
+
+model Sku {
+    id        String  @id @default(cuid())
+    sku       String  @unique
+    product   Product @relation(fields: [productId], references: [id])
+    price     Price?  @relation(fields: [priceId], references: [id])
+    image     Image?  @relation(fields: [imageId], references: [id])
+    productId String
+    priceId   String?
+    imageId   String?
+}
+
+model Attribute {
+    id       String @id @default(cuid())
+    name     String
+    options  String
+    position Int
+}
+
+model Price {
+    id              String            @id @default(cuid())
+    DKK             Int
+    USD             Int
+    EUR             Int
+    GBP             Int
+    Product         Product[]
+    Sku             Sku[]
+    ShippingProfile ShippingProfile[]
+}
+
+model Cart {
+    id        String   @id @default(cuid())
+    createdAt DateTime @default(now())
+    items     String?
+}
+
+model ShippingProfile {
+    id      String @id @default(cuid())
+    code    String @unique
+    price   Price  @relation(fields: [priceId], references: [id])
+    priceId String
+}
+
+model PurchasedSku {
+    id            String  @id @default(cuid())
+    code          String
+    name          String
+    price         Int
+    currency      String
+    image         String
+    variationInfo String
+    Order         Order?  @relation(fields: [orderId], references: [id])
+    orderId       String?
+}
+
+model Order {
+    id            String         @id @default(cuid())
+    createdAt     DateTime       @default(now())
+    items         PurchasedSku[]
+    shipping      String
+    shippingCosts String
+    total         Int
+    currency      String
+    charge        String
+    customer      Customer       @relation(fields: [customerId], references: [id])
+    shippedAt     DateTime?
+    fullfilled    Boolean        @default(false)
+    archived      Boolean        @default(false)
+    trackingCode  String?
+    auth          String         @unique
+    customerId    String
+}
+
+model Customer {
+    id        String   @id @default(cuid())
+    createdAt DateTime @default(now())
+    email     String
+    name      String
+    address   String
+    address2  String?
+    city      String
+    zip       String
+    country   String
+    orders    Order[]
+}
```


